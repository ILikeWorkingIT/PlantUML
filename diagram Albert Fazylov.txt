@startuml

title Процесс выдачи кредитной карты (диаграмма разработана А.Фазыловым в PlantUML)


actor Клиент as Client
participant "Платформа \n интернет-банкинга" as PIB
participant CCS
participant АБС as ABC
participant CRM
participant "Карточный \n процессинг" as KP
participant ESB

' Аутентификация клиента на платформе
autonumber 1.1

Activate Client
Client -> PIB ++: Аутентификация на платформе \n ввод логина и пароля
PIB -> PIB : Проверка логина

alt Пользователь найден
PIB -> PIB : Проверка пароля

alt Пароль верный
PIB -->> Client : Сообщение об успешной аутентификации

else Пароль неправильный
PIB -->> Client : Сообщение, что пароль неверный

end alt

else Пользователь не найден
PIB -->> Client : Сообщение, что пользователь \n с данным логином не найден
end alt

' Работа с заявкой
autonumber inc A

Client -> PIB : Создание и заполнение данных заявки
PIB -> ESB ++: Передача данных заявки
ESB -->> PIB : Данные получены
Deactivate PIB
ESB -> CRM ++: Передача данных заявки
CRM -->> ESB : Данные получены
CRM -> CRM : Сохранение данных заявки

CRM -> ESB : Передача данных CRM и кредитной истории
ESB -->> CRM : Данные получены
Deactivate CRM

' Решение о выдаче
autonumber inc A

ESB -> CCS ++: Передача данных заявки и CRM, кредитной истории \n для решения о выдаче карты
CCS -->> ESB :Данные получены

CCS -> CCS : Принятие решения о выдаче \n кредитной карты и \n ее максимальном лимите
CCS -> ESB : Передача решения по выдаче (положительное или отрицательное). \n Максимальный лимит карты при положительном решении
ESB -->> CCS :Данные получены
Deactivate CCS

' Изменение кредитной истории в CRM
ESB -> CRM ++: Изменения в кредитной истории клиента
CRM -->> ESB : Данные получены
CRM -> CRM : Вношу изменения кредитной истории
Deactivate CRM

alt Положительное решение
ESB -> PIB ++: Решение положительное. Максимальный лимит карты ХХХ рублей
PIB -->> ESB: Данные получены
PIB -->> Client : Сообщение о предварительном согласии \n о выдаче кредитной карты \n с лимитом ХХХ рублей
Deactivate PIB

else Решение отрицательное
ESB -> PIB ++: Решение отрицательное
PIB -->> ESB: Данные получены
PIB -->> Client : Сообщение об отказе \n в выдаче кредитной карты
Deactivate PIB

end alt

' Работа с договором
autonumber inc A


ESB -> ABC ++: Передача данных одобренной заявки и CRM, \n максимального лимита карты \n для создания договора
ABC -->> ESB: Данные получены
ABC -> ABC : Создание текста договора
ABC -> ESB : Текст договора
ESB -->> ABC: Данные получены
Deactivate ABC

ESB -> PIB ++: Текст договора на выдачу кредитной карты
PIB -->> ESB: Данные получены
PIB -->> Client : Прошу подписать \n электронный договор \n на выдачу кредитной карты

alt Клиент подписывает
Client -> PIB : Клиент поставил электронную подпись
PIB -> ESB: Договор подписан клиентом
ESB -->> PIB : Данные получены
Deactivate PIB

' Изменение кредитной истории в CRM
ESB -> CRM ++: Изменения в кредитной истории клиента
CRM -->> ESB : Данные получены
CRM -> CRM : Вношу изменения кредитной истории
Deactivate CRM

else Клиент отказался подписывать
Client -> PIB ++: Клиент отказался подписывать
PIB -> ESB: Отказ клиента в подписании договора
ESB -->> PIB : Данные получены
Deactivate PIB

' Изменение кредитной истории в CRM
ESB -> CRM ++: Изменения в кредитной истории клиента
CRM -->> ESB : Данные получены
CRM -> CRM : Вношу изменения кредитной истории
Deactivate CRM
end alt

' Выпуск карты
autonumber inc A

ESB -> KP ++: Передача данных для выпуска кредитной карты
KP -->> ESB : Данные получены
KP -> KP : Выпуск кредитной карты
KP -> ESB : Кредитная карта выпущена
ESB -->> KP : Данные получены
Deactivate KP

' Изменение кредитной истории в CRM
ESB -> CRM ++: Изменения в кредитной истории клиента
CRM -->> ESB : Данные получены
CRM -> CRM : Вношу изменения кредитной истории
Deactivate CRM

ESB -> PIB ++: Кредитная карта изготовлена. Информация по ее получению.
PIB -->> ESB: Данные получены
PIB -->> Client : Кредитная карта выпущена. \n Информация, как ее получить
Deactivate PIB

ref over Client, ESB
Внешний процесс "Передача кредитной карты клиенту"
end ref

' Изменение кредитной истории в CRM
ESB -> CRM ++: Изменения в кредитной истории клиента
CRM -->> ESB : Данные получены
CRM -> CRM --: Вношу изменения кредитной истории
Deactivate ESB


@enduml
